---
output:
  github_document:
    html_preview: false
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  fig.width = 4,
  fig.height = 4,
  fig.align = "center",
  dpi = 300)
library(ckbplotr)
library(grid)
library(gridExtra)
```
# ckbplotr <img src="man/figures/logo.png" align="right" width = "120" />
<!-- badges: start -->
[![R build status](https://github.com/neilstats/ckbplotr/workflows/R-CMD-check/badge.svg)](https://github.com/neilstats/ckbplotr/actions)
[![Codecov test coverage](https://codecov.io/gh/neilstats/ckbplotr/branch/main/graph/badge.svg)](https://codecov.io/gh/neilstats/ckbplotr?branch=main)
[![DOI](https://zenodo.org/badge/189028664.svg)](https://zenodo.org/badge/latestdoi/189028664)
<!-- badges: end -->

`ckbplotr` provides functions to help create and style plots in R. It is being
developed by, and primarily for, [China Kadoorie Biobank](http://www.ckbiobank.org) 
researchers.

*This package is under development. If you find an error or bug or have a suggestion for improvement please create an issue on GitHub or contact the author at [neil.wright@ndph.ox.ac.uk](mailto:neil.wright@ndph.ox.ac.uk) or [\@NeilStats](https://twitter.com/NeilStats).*

It can be used to: create plots of estimates and CIs against risk factor levels...
```{r example-shape-plot, echo = FALSE, out.width = "50%"}
results <- ckbplotr_shape_data %>% 
  dplyr::filter(is_female == 0)

plot <- shape_plot(results,
                   col.x        = "rf",
                   col.estimate = "est",
                   col.stderr   = "se",
                   col.n        = "n",
                   xlims        = c(15,50),
                   ylims        = c(0.5, 2.5),
                   scalepoints  = TRUE,
                   ciunder      = TRUE,
                   printplot     = FALSE,
                   envir        = environment())

plot$plot + theme(plot.margin = margin(8, 8, 8, 8, "mm"))
```


...create forest plots...
```{r example-forest-plot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, out.width = "90%"}
resultsA <- dplyr::filter(ckbplotr_forest_data, name == "A")
resultsB <- dplyr::filter(ckbplotr_forest_data, name == "B")

forestplot <- forest_plot(row.labels        = ckbplotr_row_labels,
                          row.labels.levels = c("heading", "subheading", "label"),
                          rows              = c("Lipoprotein particle concentration",
                                                "Triglycerides concentration"),
                          panels            = list(resultsA, resultsB),
                          exponentiate      = TRUE,
                          panel.names       = c("Analysis A", "Analysis B"),
                          col.key           = "variable",
                          ci.delim          = " - ",
                          xlim              = c(0.9, 1.1),
                          xticks            = c(0.9, 1, 1.1),
                          blankrows         = c(1, 1, 0, 1),
                          scalepoints       = TRUE,
                          pointsize         = 3,
                          col.left          = c("n"),
                          col.left.heading  = c("No. of\nevents"),
                          col.heading.space = 1.5,
                          envir             = environment())
```

...and convert other ggplots to CKB style.
```{r a-plot, echo = FALSE, fig.width=8, out.width = "80%"}
plot <- ggplot(data = mpg, aes(x = displ, y = hwy)) + geom_point(size = 1)
arrow <- grid::textGrob("\u2192")
ckbplot <- plot_like_ckb(plot = plot, xlims = c(0, 8), ylims = c(10, 50))
grid.arrange(plot, arrow, ckbplot, ncol = 3, widths = c(1, 0.25, 1))
```


## Installation

### From R-universe
The latest version of `ckbplotr` can be installed from the neilstats R-universe using `install.packages()`.
```{r install from runiverse, eval = FALSE}
install.packages('ckbplotr',
                 repos = c('https://neilstats.r-universe.dev', 'https://cloud.r-project.org'))
```
This will also install dependencies from the CRAN repository.

### From github
The latest version of `ckbplotr` can also be installed from 
github using the `remotes` package.
```{r install from github, eval = FALSE}
install.packages('remotes')
remotes::install_github('neilstats/ckbplotr')
```

## Get started

Read `vignette("ckbplotr")` to see how to use the `shape_plot()`, `forest_plot()`, and `plot_like_ckb()` functions.


## ggplot2 code

The `shape_plot()` and `forest_plot()` functions return both a plot and the ggplot2 code used to create the plot. In RStudio the ggplot2 code used to create the plot will be shown in the Viewer pane.

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making shape plots • ckbplotr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Making shape plots">
<meta property="og:description" content="ckbplotr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ckbplotr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/make_forest_plot.html">Making forest plots</a>
    </li>
    <li>
      <a href="../articles/make_shape_plot.html">Making shape plots</a>
    </li>
    <li>
      <a href="../articles/plot_like_ckb.html">Make a ggplot like a CKB plot</a>
    </li>
    <li>
      <a href="../articles/special_characters_formatting.html">Using special characters and formatting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/neilstats/ckbplotr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="make_shape_plot_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Making shape plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/neilstats/ckbplotr/blob/master/vignettes/make_shape_plot.Rmd"><code>vignettes/make_shape_plot.Rmd</code></a></small>
      <div class="hidden name"><code>make_shape_plot.Rmd</code></div>

    </div>

    
    
<p>The <code>make_shape_plot</code> function creates a plot of estimates and CIs against risk factor levels using the <code>ggplot2</code> package.</p>
<p>The function returns a named list containing:</p>
<ul>
<li>plot: the plot</li>
<li>code: ggplot2 code to generate the plot</li>
</ul>
<p>The function uses the <code>plot_like_ckb</code> function to modify the theme and control the look of the plot.</p>
<p>In RStudio, the ggplot2 code used to generate the plot will be shown in the ‘Viewer’ pane. This code can be copied and further edited to adapt the plot.</p>
<div id="prepare-example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-example-data" class="anchor"></a>Prepare example data</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  est       = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(   <span class="fl">1</span>, <span class="fl">1.25</span>,  <span class="fl">1.5</span>, <span class="fl">1.75</span>,  <span class="fl">1.7</span>, <span class="fl">1.85</span>, <span class="fl">2.25</span>, <span class="fl">2.6</span>),
  se        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.08</span>, <span class="fl">0.03</span>, <span class="fl">0.07</span>, <span class="fl">0.15</span>, <span class="fl">0.08</span>, <span class="fl">0.08</span>, <span class="fl">0.07</span>, <span class="fl">0.1</span>),
  rf        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(  <span class="fl">20</span>,   <span class="fl">28</span>,   <span class="fl">38</span>,   <span class="fl">50</span>, <span class="fl">18.5</span>,   <span class="fl">25</span>,   <span class="fl">37</span>,  <span class="fl">47</span>),
  n         = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">109</span>,  <span class="fl">103</span>,  <span class="fl">143</span>,  <span class="fl">104</span>,  <span class="fl">140</span>,  <span class="fl">134</span>,  <span class="fl">127</span>,  <span class="fl">99</span>),
  is_female = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(   <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">1</span>,    <span class="fl">1</span>,   <span class="fl">1</span>)
)
</pre></div>
</div>
<div id="simple-example" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-example" class="anchor"></a>Simple example</h2>
<p>Given a data frame of estimates and standard errors (to be plotted on the y axis), and risk factor levels (to be plotted on the x axis), a plot can be created.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>[<span class="kw">results</span><span class="op">$</span><span class="kw">is_female</span> <span class="op">==</span> <span class="fl">0</span>,],
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/simple-example-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="log-scale" class="section level2">
<h2 class="hasAnchor">
<a href="#log-scale" class="anchor"></a>Log scale</h2>
<p>Set the <code>logscale</code> argument to true to use a log scale on the vertical axis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>[<span class="kw">results</span><span class="op">$</span><span class="kw">is_female</span> <span class="op">==</span> <span class="fl">0</span>,],
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>, <span class="fl">3</span>),
                        ybreaks      = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>,
                        logscale     = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/log-scale-1.png" width="384" style="display: block; margin: auto;"> If your estimates and standard errors are on the log scale (e.g. log hazard ratios), then set <code>exponentiate</code> to true. This will plot exp(estimates) and use a log scale for the axis (if <code>logscale</code> is not set).</p>
</div>
<div id="using-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#using-groups" class="anchor"></a>Using groups</h2>
<p>The <code>col.group</code> argument can be supplied to plot results for different groups (using shades of grey for the fill colour). (Set <code>ciunder</code> to <code>TRUE</code> so that the confidence interval lines are hidden behind behind the point estimate squares.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>,
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        col.group    = <span class="st">"is_female"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>,
                        ciunder      = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/groups-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="adding-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-lines" class="anchor"></a>Adding lines</h2>
<p>The <code>lines</code> argument will add lines (linear fit through estimates on plotted scale, weighted by inverse variance) for each group.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>,
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        col.group    = <span class="st">"is_female"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>,
                        ciunder      = <span class="fl">TRUE</span>,
                        lines        = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/lines-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="setting-aesthetics" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-aesthetics" class="anchor"></a>Setting aesthetics</h2>
<p>The shape and fill colour of points, and colour of points and confidence interval lines can be set overall or on a per-point basis. This is done by setting arguments <code>shape</code>, <code>colour</code>, <code>cicolour</code>, <code>fill</code>, and <code>ciunder</code> to appropriate values, or to the name of a column containing values for each point.</p>
<p>The argument/columns, what they control, and the type:</p>
<table class="table">
<thead><tr class="header">
<th>argument</th>
<th>controls</th>
<th>type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>shape</td>
<td>plotting character for points</td>
<td>integer</td>
</tr>
<tr class="even">
<td>colour</td>
<td>colour of points</td>
<td>character</td>
</tr>
<tr class="odd">
<td>cicolour</td>
<td>colour of CI lines</td>
<td>character</td>
</tr>
<tr class="even">
<td>fill</td>
<td>fill colour of points</td>
<td>character</td>
</tr>
<tr class="odd">
<td>ciunder</td>
<td>if the CI line should be plotted before the point</td>
<td>logical</td>
</tr>
</tbody>
</table>
<div id="using-values" class="section level3">
<h3 class="hasAnchor">
<a href="#using-values" class="anchor"></a>Using values</h3>
<p>If the argument doesn’t match the anem of a column in the data, then the value will be used for all points.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>,
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>,
                        ciunder      = <span class="fl">TRUE</span>,
                        shape        = <span class="fl">23</span>,
                        colour       = <span class="st">"black"</span>,
                        fill         = <span class="st">"red"</span>,
                        cicolour     = <span class="st">"blue"</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/aesthetics%20with%20values-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="using-columns" class="section level3">
<h3 class="hasAnchor">
<a href="#using-columns" class="anchor"></a>Using columns</h3>
<p>If the argument matches a column name, then the values in the column will be used.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">results</span><span class="op">$</span><span class="kw">fillcol</span> <span class="op">&lt;-</span> <span class="st">"black"</span>
<span class="kw">results</span>[<span class="kw">results</span><span class="op">$</span><span class="kw">is_female</span> <span class="op">==</span> <span class="fl">1</span>,]<span class="op">$</span><span class="kw">fillcol</span> <span class="op">&lt;-</span> <span class="st">"orange"</span>

<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>,
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>,
                        ciunder      = <span class="fl">TRUE</span>,
                        colour       = <span class="st">"fillcol"</span>,
                        fill         = <span class="st">"fillcol"</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/aesthetics%20with%20columns-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Specify a column for <code>cicolour</code> is useful for changing the colour of confidence interval lines that would otherwise be hidden.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">results</span><span class="op">$</span><span class="kw">cicol</span> <span class="op">&lt;-</span> <span class="st">"black"</span>
<span class="kw">results</span>[<span class="fl">2</span>,]<span class="op">$</span><span class="kw">cicol</span> <span class="op">&lt;-</span> <span class="st">"white"</span>

<span class="kw">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_shape_plot.html">make_shape_plot</a></span>(<span class="kw">results</span>,
                        col.x        = <span class="st">"rf"</span>,
                        col.estimate = <span class="st">"est"</span>,
                        col.stderr   = <span class="st">"se"</span>,
                        col.n        = <span class="st">"n"</span>,
                        xlims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">50</span>),
                        ylims        = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">3</span>),
                        scalepoints  = <span class="fl">TRUE</span>,
                        title        = <span class="kw">NULL</span>,
                        pointsize    = <span class="fl">7</span>,
                        cicolour     = <span class="st">"cicol"</span>)
</pre></div>
<p><img src="make_shape_plot_files/figure-html/small%20ci-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Note that the size of boxes depends on <code>pointsize</code>, but the true length of confidence interval lines depends on the size at which the plot is displayed or saved. So, first save your plot as an image then go back to change the colour of confidence interval lines as needed.</p>
</div>
</div>
<div id="stroke" class="section level2">
<h2 class="hasAnchor">
<a href="#stroke" class="anchor"></a>Stroke</h2>
<p>The <code>stroke</code> argument sets the stroke aesthetic for plotted shapes. See <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html" class="uri">https://ggplot2.tidyverse.org/articles/ggplot2-specs.html</a> for more details. The stroke size adds to total size of a shape, so unless <code>stroke = 0</code> the scaling of size by inverse variance will be slightly inaccurate (but there are probably more important things to worry about).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Neil Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
